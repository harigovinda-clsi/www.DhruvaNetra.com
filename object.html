<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Object Detail ¬∑ DhruvaNetra</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@500;600&family=Inter:wght@400;500&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">

<style>
/* --- SAME DESIGN, UNTOUCHED --- */
body {
  margin: 0;
  background: #08090c;
  color: #e8eaed;
  font-family: Inter, system-ui, sans-serif;
}
nav {
  padding: 1rem 2rem;
  border-bottom: 1px solid rgba(255,255,255,0.08);
  display: flex;
  justify-content: space-between;
}
a { color: #6ea8fe; text-decoration: none; }
.container { max-width: 1200px; margin: 2rem auto; padding: 0 2rem; }
h1 { font-family: "Space Grotesk"; }
.muted { color: #9aa4b2; }
.card {
  background: #0f1116;
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 8px;
  padding: 1.5rem;
  margin-bottom: 1.5rem;
}
.badge {
  padding: 0.3rem 0.7rem;
  border-radius: 4px;
  font-size: 0.7rem;
  font-family: "IBM Plex Mono";
}
.badge.alert { background: rgba(255,0,0,0.15); color: #ff6b6b; }
.badge.safe { background: rgba(0,255,0,0.15); color: #34d399; }
</style>

<!-- üîê ROUTE GUARD (ONLY PLACE WHERE REDIRECT IS ALLOWED) -->
<script>
const token = localStorage.getItem("token");
if (!token) {
  window.location.replace("login.html");
}
</script>
</head>

<body>

<nav>
  <a href="dashboard.html">‚Üê Dashboard</a>
  <span class="muted">Object View</span>
</nav>

<div class="container">
  <h1 id="name">Loading...</h1>
  <span id="hazard" class="badge"></span>

  <p id="summary" class="muted"></p>

  <div class="card">
    <h3>Approach Details</h3>
    <p><b>Velocity:</b> <span id="velocity">‚Äî</span> km/s</p>
    <p><b>Miss Distance:</b> <span id="distance">‚Äî</span> AU</p>
    <p><b>Date:</b> <span id="date">‚Äî</span></p>
  </div>

  <div class="card">
    <h3>Risk Assessment</h3>
    <p><b>Risk Score:</b> <span id="risk">‚Äî</span></p>
  </div>

  <div class="card muted" id="errorBox" style="display:none;">
    Data temporarily unavailable. Page remains accessible.
  </div>
</div>

<script>
const API_BASE = "https://backend-www-dhruvanetra-com.onrender.com";

/* ‚úÖ SAFE API CALL ‚Äî NO REDIRECTS HERE */
async function apiGet(path) {
  try {
    const res = await fetch(API_BASE + path, {
      headers: {
        Authorization: "Bearer " + localStorage.getItem("token")
      }
    });

    if (!res.ok) return null;   // ‚ùå no logout, no redirect
    return await res.json();
  } catch {
    return null;
  }
}

(async () => {
  const params = new URLSearchParams(window.location.search);
  const id = params.get("id");

  if (!id) {
    document.getElementById("name").textContent = "Invalid object";
    return;
  }

  const data = await apiGet(`/api/neo/${id}`);

  if (!data) {
    document.getElementById("errorBox").style.display = "block";
    document.getElementById("name").textContent = "Object data unavailable";
    return;
  }

  document.getElementById("name").textContent = data.name || id;
  document.getElementById("summary").textContent =
    data.designation || "Near-Earth object under observation.";

  const hazard = document.getElementById("hazard");
  hazard.textContent = data.is_hazardous ? "Hazardous" : "Safe";
  hazard.className = "badge " + (data.is_hazardous ? "alert" : "safe");

  document.getElementById("velocity").textContent =
    data.closest_approach?.velocity_kms ?? "‚Äî";
  document.getElementById("distance").textContent =
    data.closest_approach?.miss_distance_au ?? "‚Äî";
  document.getElementById("date").textContent =
    data.closest_approach?.date ?? "‚Äî";
  document.getElementById("risk").textContent =
    data.risk_score ?? "‚Äî";
})();
</script>

</body>
</html>
